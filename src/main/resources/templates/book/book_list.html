<!DOCTYPE html>
<html th:replace="~{default :: layout(~{::title}, ~{::section})}" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Book List</title>
</head>
<body>
<section class="col-md-12">
    <table class="table">
        <thead>
        <tr>
            <th>ISBN</th>
            <th>Title</th>
            <th>Author</th>
            <th>Subject</th>
            <th>Price</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>

        <tr th:each="book : ${books}">
            <td>
                <a th:href="@{/book/{isbn}(isbn=${book.isbn})}" th:text="${book.isbn}"></a>
            </td>
            <td th:text="${book.title}"></td>
            <td th:text="${book.author}"></td>
            <td th:text="${book.subject}"></td>
            <td th:text="'$'+${#numbers.formatDecimal(book.price, 0, 2)}"></td>
            <td><button class="btn btn-info addCartButton" th:data="${book.isbn}">Add to Cart</button>  </td>
        </tr>
        </tbody>
    </table>
    <script>
        window.onload = function () {
            $('.addCartButton').click(function() {
                var btn = $(this);
                btn.removeClass('btn-info');
                btn.addClass('btn-warning');
                btn.html('Adding...')
                $.ajax({
                    type: 'POST',
                    url: '/cart/add',
                    data: {'isbn': $(this).attr('data')},
                    success: function() {
                        btn.html("Added");
                        btn.removeClass('btn-warning');
                        btn.addClass('btn-success');
                    },
                    failure: function() {
                        btn.html("Failed to add to cart.");
                        btn.removeClass('btn-warning');
                        btn.addClass('btn-danger');
                    }
                })
            })
        }
    </script>
</section>
</body>
</html>